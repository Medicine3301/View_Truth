import google.generativeai as genai

# 確保 API 金鑰正確無誤
genai.configure(api_key="AIzaSyChZPbwnQY-JPm7cPU8kSDn3PiO1Amfo2Q")

# 建立模型物件
model = genai.GenerativeModel("gemini-1.5-flash")

# Prompt 模版
def create_prompt(user_query):
    return f"""
    你是一個網路內容分析專家，專注於幫助使用者釐清內容的真實性，給予查證建議。

    核心目標：
    1. 修改標題，使其更準確、符合內容且不誇大。
    2. 改寫整體內容，分段撰寫，保持語意清晰。
    3. 提供真實性的分析報告，包括關鍵內容的真實性評估，也要評估前後文、知識的正確性。
    4. 給出查證建議，幫助讀者進一步了解事實。
    5. 為內容真實性進行1到5分的評分。
    6. 你得嚴格，不容許錯誤，要先自行確認下

    文章：
    {user_query}

    請根據以上目標生成結果，並按照以下格式返回：
    {{
      "title": "改進後的標題",
      "content": "僅需改寫後的內容，不需分析，請分段撰寫。",
      "ana": "客觀的真實性分析。",
      "score": 真實性評分 (1-5),
      "class":"分類"
      "suggestions": "給讀者的查證建議"
    }}

    請確保輸出簡潔且專注於內容，避免多餘的背景分析。
    """

# 用戶提供的新聞文章
user_query = """
標題：國中兒「嗆堵」同學　黑幫父糾33小弟把對方打到腦震盪骨折
CNEWS匯流新聞網記者李映儒／台北報導

CNEWS匯流新聞網記者王昭濱／綜合報導

去年3月間，桃園市陳姓與洪姓國中生在校園內與同學發生碰撞，雙方也在LINE群組內互嗆，結果有黑道背景的陳姓國中生父親得知後，竟撂來33人與對方學生、家長等6人相約談判，過程中手下還把對方打成腦震盪、骨折。桃園地院審理後，陳父被依《組織犯罪條例》、聚眾強暴罪、與少年共同對少年犯傷害罪等，合併判處應執行有期徒刑4年10個月，其餘幫眾分別判處有期徒刑6個月至3年10個月不等，全案還可上訴。


檢警調查，竹聯幫信堂陳姓副會長其子，就讀平鎮區某國中，但在校因與同校6名同學發生網路言語糾紛，陳父便邀約對方學生與家長談判同時，糾眾30餘人助威。

談判過程中，陳父竟持刀威嚇及毆打學生與家長，致使被害人腦震盪、骨折等，還以危害生命等恐嚇言詞，致使學生與家長身心受創，檢方認為陳婦等3人以眾欺寡、戕害學子等行為惡劣，罪嫌重大，有勾串滅證之虞，向法院聲請羈押。




桃園地院審理後作出判決，陳父違反《組織犯罪條例》，處有期徒刑3年6個月；聚眾強暴罪，處有期徒刑6個月；成年人與少年共同對少年犯傷害罪，處有期徒刑1年6個月；招募他人加入犯罪組織，處有期徒刑8個月，合併執行有期徒刑4年10個月。其餘幫眾則分別判處有期徒刑6個月至3年10個月不等，本案還可上訴。

照片來源：翻攝畫面
"""

# 生成 Prompt
prompt = create_prompt(user_query)

# 確保請求中沒有額外的非法 Header
try:
    response = model.generate_content(prompt)
    print(response.text)
except Exception as e:
    print("請求失敗：", e)
