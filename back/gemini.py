import google.generativeai as genai

# 確保 API 金鑰正確無誤
genai.configure(api_key="AIzaSyChZPbwnQY-JPm7cPU8kSDn3PiO1Amfo2Q")

# 建立模型物件
model = genai.GenerativeModel("gemini-1.5-flash")

# Prompt 模版
def create_prompt(user_query):
    return f"""
    你是一個網路內容分析專家，專注於幫助使用者釐清內容的真實性，給予查證建議。

    核心目標：
    1. 修改標題，使其更準確、符合內容且不誇大。
    2. 改寫整體內容，分段撰寫，保持語意清晰。
    3. 提供真實性的分析報告，包括關鍵內容的真實性評估，也要評估前後文、知識的正確性。
    4. 給出查證建議，幫助讀者進一步了解事實。
    5. 為內容真實性進行1到5分的評分。
    6. 你得嚴格，不容許錯誤，要先自行確認下

    文章：
    {user_query}

    請根據以上目標生成結果，並按照以下格式返回：
    {{
      "title": "改進後的標題",
      "content": "僅需改寫後的內容，不需分析，請分段撰寫。",
      "ana": "客觀的真實性分析。",
      "score": 真實性評分 (1-5),
      "class":"分類"
      "suggestions": "給讀者的查證建議"
    }}

    請確保輸出簡潔且專注於內容，避免多餘的背景分析。
    """

# 用戶提供的新聞文章
user_query = """
獨家／熱炒店遇「免費白飯大隊」！30學生「狂掃2桶飯」嗆沒吃飽還洗1星
    記者劉沛妘／台北報導

位在台北市民大道上的「大道快炒」，主打多款創意熱炒料理。（圖／翻攝自google map）

▼▲位在台北市民大道上的「大道快炒」，主打多款創意熱炒料理。（圖／翻攝自google map）

位在台北市民大道上的「大道快炒」，主打多款創意熱炒料理。（圖／翻攝自google map）

熱炒店是許多民眾吃飯聚會的首選，多樣的菜色配上白飯總讓人吃不停，但遇到「蝗蟲過境」就讓店家頭疼了！位在台北市民大道上的知名熱炒店「大道創意料理快炒」，昨(8)日有多達30-40名學生「沒訂位」就到店吃飯，可能是學生很餓，在菜都還沒上齊時就把「2大桶白飯嗑光」，學生不滿吃不飽，進而到google上狂洗1星負評，對此，老闆無奈說：「一下子那麼多人，根本來不及煮！」

老闆向《三立新聞網》表示，昨天有學生臨時打電話來問說有沒有位子，本來說20人左右來用餐，結果一到現場發現多達30-40人，之前也有遇過類似沒訂位就來很多客人的情形，基本上事先備好的2鍋飯是將近70人份量，並不是大問題，「但這些學生在菜都還沒上，就把2鍋近70人的白飯吃光，他們就狂吃白飯而已！」

接著學生抱怨沒白飯了，店家建議可以先點炒麵、炒飯，因為煮白飯需要時間，但學生回應「不要」，且還沒等到白飯煮完，就不滿吃不飽而離開了，老闆表示，他們沒有在餐廳現場胡鬧，但回去卻在google狂洗1星負評，本來評價4.1被洗到4.0，遇到這樣的事情很難過。

店家慘遭學生洗1星負評。（圖／翻攝自google map）

▼▲店家慘遭學生洗1星負評。（圖／翻攝自google map）

店家慘遭學生洗1星負評。（圖／翻攝自google map）

據了解，該群學生是忙完整天的活動，晚上臨時到熱炒店慶功吃飯，老闆喊冤：「可以理解學生肚子餓，但一次30多人來，要炒菜還要煮飯，時間真的比較緊迫，且也很少遇到30人吃60人的飯量；加上他們30多人共消費6000多元，平常10人桌消費約3000元，他們平均一人消費不到220元，可能是學生在壓預算，我白飯雖然是免費供應，但不是要免費讓你吃到飽！」
"""

# 生成 Prompt
prompt = create_prompt(user_query)

# 確保請求中沒有額外的非法 Header
try:
    response = model.generate_content(prompt)
    print(response.text)
except Exception as e:
    print("請求失敗：", e)
